Hi all!

This is a module to merge a few api calls into one to extremely decrease the number of AJAX requests on client.

Inside it uses a technology HTTP Pipelining so even if you are merging 100 API calls you'll get a result not later then slowest API call in a given set.

That's very easy to inject into your project.
Just do few things:

cd YOUR_PROJECT_NAME
npm install api-call-merger

and inside your code add:

var APICallMerger = require('api-call-merger'); 
var API = new APICallMerger( );

After you have to set prefix of your API:
API.setMainAPIUrl('/api/resources');

Attach an HTTP Object (from require('http'));
API.attachHttpObject(http);

If you want, you can set maximum number of url parameters ( in result query - groups )
API.setMaxUrlParams(100);

To filter some villains, module has a function that starts before a api call and allow or discard api execution. It's async so you can realizie logic with Redis, for example Rate Limiter and/or Black List
API.setSecureOptions(true, functionToCheckUsersTrustworthy);
and example of this function 
function functionToCheckUsersTrustworthy(param1, callback) {
	// to allow api call after calculations inside a function just do: callback(true) or callback(false)
}

And final - add some routes and API URLs

API.addAPIRoute('API_NAME_IN_URL_PARAMETER', 'API_URL_FOR_REQUEST', IS_API_NAME_STRICT_OR_TEMPLATE? ); 

// To handle only api/users
API.addAPIRoute('api/users', 		'http://st1.craziegames.com:3000/api/users', 	 	true);

// To handle api/users/id1, api/users/777, etc. 
API.addAPIRoute('api/users/', 		'http://st1.craziegames.com:3000/api/users/', 	 	false);

API.addAPIRoute('api/customers', 	'http://st1.craziegames.com:3000/api/customers', 	true);
API.addAPIRoute('api/customers/', 	'http://st1.craziegames.com:3000/api/customers/', 	false);
API.addAPIRoute('api/countries', 	'http://st1.craziegames.com:3000/api/countries', 	true);
API.addAPIRoute('api/countries/', 	'http://st1.craziegames.com:3000/api/countries/', 	false);

And call!

API.safeApiRequest(requestUrl, function(data) {
	res.send(data);
}, 'param_to_secure_function');

--------------------------------------------------

How to test with Mocha and full project please browse on Github page ( https://github.com/doexclusive/api-call-merger-example )

Some more information you can find inside a code (index.js)

or can try It on website:

Main API url is http://st1.craziegames.com:3001/api/resources?

Allowed APIs are:

	api/users
	api/users/id101
	api/users/id102
	api/users/id103

	api/customers
	api/customers/id301
	api/customers/id302
	api/customers/id303

	api/countries
	api/countries/id401
	api/countries/id402
	api/countries/id403

So the format is :
	http://st1.craziegames.com:3001/api/resources?groupName1=apiName1...groupNameN=apiNameN

Examples:

1) http://st1.craziegames.com:3001/api/resources?users=api/users/id101&customer=api/customers/id301&coutries=api/countries

returns:

	{"users":"{\"id\":\"id101\",\"firstName\":\"Mike\",\"age\":21}","customer":"{\"id\":\"id301\",\"fullName\":\"Bill M.\",\"moneySpent\":10000}","coutries":"[{\"id\":\"id401\",\"countryName\":\"DENMARK\",\"countryCode\":\"DK\"},{\"id\":\"id402\",\"countryName\":\"UKRAINE\",\"countryCode\":\"UA\"},{\"id\":\"id403\",\"countryName\":\"USA\",\"countryCode\":\"US\"}]"}

2) http://st1.craziegames.com:3001/api/resources?userOne=api/users/id101&userTwo=api/users/id102

returns:

{"userOne":"{\"id\":\"id101\",\"firstName\":\"Mike\",\"age\":21}","userTwo":"{\"id\":\"id102\",\"firstName\":\"Bob\",\"age\":22}"}

3) http://st1.craziegames.com:3001/api/resources?users=api/users&countries=api/countries

returns:

{"users":"[{\"id\":\"id101\",\"firstName\":\"Mike\",\"age\":21},{\"id\":\"id102\",\"firstName\":\"Bob\",\"age\":22},{\"id\":\"id103\",\"firstName\":\"John\",\"age\":23}]","countries":"[{\"id\":\"id401\",\"countryName\":\"DENMARK\",\"countryCode\":\"DK\"},{\"id\":\"id402\",\"countryName\":\"UKRAINE\",\"countryCode\":\"UA\"},{\"id\":\"id403\",\"countryName\":\"USA\",\"countryCode\":\"US\"}]"}






